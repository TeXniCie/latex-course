\NeedsTeXFormat{LaTeX2e}
\ProvidesClass{cursuspresentatie}[2021/09/27 cursuspresentatie v0.1.0]

%\LoadClass{beamer}

\newif\ifishandout
\ishandoutfalse
%\ishandouttrue

\ifishandout
    \LoadClass[handout,aspectratio=32]{beamer}
\else
    \LoadClass[aspectratio=32]{beamer}
\fi


\RequirePackage[tabsize=4]{highlightlatex}

\setbeamertemplate{caption}[numbered]

%\usetheme{aes2}

% \usecolortheme{rose}
% %\useinnertheme[shadow]{rounded}
% \useinnertheme{rounded}

\usetheme{Dresden}
\usecolortheme{dolphin}
\useoutertheme{miniframes}

\RequirePackage{subfiles}
\RequirePackage{amsmath,amssymb,amsthm,commath,mathtools}
\RequirePackage{esint}
\RequirePackage{enumerate}
\RequirePackage{subcaption}
\RequirePackage{graphicx}
\RequirePackage{xcolor}
\RequirePackage{adjustbox}
\RequirePackage{soul}
\RequirePackage{booktabs}
\RequirePackage{tabularx}
\RequirePackage{environ}
\RequirePackage{etoolbox}
\RequirePackage{yfonts}

\newbool{english}
\booltrue{english}


\ifbool{english}{
	\RequirePackage[greek,english]{babel}
}{
	\RequirePackage[greek,dutch]{babel}
}
\RequirePackage[utf8]{inputenc}
\RequirePackage{fancyvrb}
\RequirePackage{marvosym}
\RequirePackage{csquotes}
\RequirePackage[style=numeric]{biblatex}
\RequirePackage{textcomp}
%\RequirePackage{enumitem}
\RequirePackage{hyperref}
\RequirePackage{xkeyval}
\RequirePackage[T1]{fontenc}
\RequirePackage{textgreek}
\RequirePackage{lmodern}
\RequirePackage{mhchem}

\RequirePackage{ragged2e}

\RequirePackage{import}
\RequirePackage{inputslide}
\RequirePackage{multicol}


\newcommand{\TeXniCie}{\TeX niCie}

%\newcommand\lang[2]{%

\makeatletter
\def\lang{%
	\@ifnextchar,%
	{\lang@i}%
	{\lang@ii}%
}


\def\lang@i,#1,#2,{%
	\ifbool{english}{%
		#1%
	}{%
		#2%
	}%
}
\long\def\lang@ii#1#2{%
	\ifbool{english}{%
		#1%
	}{%
		#2%
	}%
}
\makeatother

\def\langsuffix{}
\lang{\gdef\langsuffix{EN}}{}

\addbibresource{\subfix{assets/fakebib.bib}}

\DeclareMathOperator{\Image}{Image}

% Source: https://tex.stackexchange.com/questions/41683/why-is-it-that-coloring-in-soul-in-beamer-is-not-visible
\let\UL\ul
\makeatletter
\renewcommand\ul{
	\let\set@color\beamerorig@set@color
	\let\reset@color\beamerorig@reset@color
	\UL
}

\let\ST\st
\makeatletter
\def\st#1{
	\begingroup
	\let\set@color\beamerorig@set@color
	\let\reset@color\beamerorig@reset@color
	\def\SOUL@uleverysyllable{%
		\rlap{%
			%\color{red}
			\the\SOUL@syllable
			\SOUL@setkern\SOUL@charkern}%
		\SOUL@ulunderline{%
			\phantom{\the\SOUL@syllable}}%
	}%
	\ST{#1}%
	\endgroup
}
\makeatother
% https://tex.stackexchange.com/questions/71051/strikeout-in-different-color-appears-behind-letters-not-on-top-of-them

\setulcolor{red}
\setstcolor{red}

% Override if you want. Else you can delete it.
%\colorlet{curlyBrackets}{red!50!blue}
%\colorlet{squareBrackets}{blue!50!white}
%\colorlet{codeBackground}{gray!10!white}
%\colorlet{comment}{green!40!black}

\updatehighlight{
	name = default,
	color = {blue!90!black},
	add = {
		\knowncommand, \figref, \textcolor, \maketitle, \subsubsection,
		\textasciigrave, \textasciiacute, \tag, \middle, \mathbb, \abs,
		\mathcal, \middle, \dfrac, \subfile, \autoref, \eqref, \cites,
		\tableofcontents, \printbibliography, \fullcite, \parencite,
		\addbibresource, \DeclareLanguageMapping, \textcite, \intertext,
		\sum, \dif, \norm, \text, \dod, \dpd, \int, \partial,
		\DeclareMathOperator, \textfb,
		\rhead, \lhead,\rfoot,\lfoot,\fancyhf,
		\co, \term, \genummerd, \bb, \cc, \dd, \ee,
		\ProvidesClass, \LoadClass, \RequirePackage, \geometry,
		\fancyhead, \fancyfoot, \sum, \adjustbox, \dimexpr, \NewEnviron,
		\BODY, \ce
	},
	name = structure,
	add = {
	},
}

\updatehighlight{
	name = greenDollar,
	style = {\itshape\color{green!70!black}},
	add = {
		% The dollar sign is provided an extra time just to
		% calm down TeXstudio's code highlighting.
		$, $
	},
	name = accentA,
	color = green!60!black,
	add = {
		\inAccA
	},
	%
	name = accentB,
	color = red!60!black,
	add = {
		\inAccB, \includegraphics
	},
	%
	name = accentC,
	color = orange!100!black,
	add = {
		\inAccC
	}
}

\lstset{tabsize=4}
\def\defaultgobble{8}

%\hllconfigure{
%	gobbletabs=3,
%}

\def\Zphantomconceal#1#2{%
	\only<#2->{\rlap{#1}}\phantom{#1}%
	%\only<#2->{#3}\unless\ifishandout\only<-#1>{\phantom{#3}}\fi
}

\def\phantomconceal#1#2{%
	\Zphantomconceal{#1}{#2}%
}

\newcommand\hideformula[2][2]{%
	%\hll|$| \only<2->{\hll|\\sqrt\{2\}|}\only<-1>{??} \hll|$|
	\hll|$| \phantomconceal{\hll|#2|}{#1} \hll|$|
}

\newcommand\hidelatex[2][2]{%
	\phantomconceal{\hll|#2|}{#1}
}%

\newcount\showcount

%\newcommand\showformula[2]{%
%	#1 & %
%	\expandafter\hideformula\expandafter[\the\showcount]{#2}%
%}
%
%\newcommand\showformula[2]{%
%	\global\showcount=\numexpr\showcount + 1\relax
%	\showformula*{#1}{#2}%
%}

\makeatletter

\def\showformula@i#1#2{%
	#1 & %
	\expandafter\hideformula\expandafter[\the\showcount]{#2}%
}

%\def\showformula{%
%	\@ifstar{%
%		\global\showcount=\numexpr\showcount + 1\relax
%		\showformula@i
%	}{%
%		\showformula@i
%	}%
%}

\def\showformula#1#2{
	#1 & \global\showcount=\numexpr\showcount + 1\relax
	\expandafter\hideformula\expandafter[\the\showcount]{#2}%
}

\def\showformulaa#1#2{
	#1 & %
	\expandafter\hideformula\expandafter[\the\showcount]{#2}%
}

\def\showlatex#1#2{
	#1 & \global\showcount=\numexpr\showcount + 1\relax
	\expandafter\hidelatex\expandafter[\the\showcount]{#2}%
}

\def\showlatexx#1#2{
	#1 & %
	\expandafter\hidelatex\expandafter[\the\showcount]{#2}%
}

\makeatother

\newlength{\naturalwidth}
\newlength{\minimumwidth}
\newbox\naturalsizebox
\newcommand{\atleastwidth}[2][2cm]{%
	\savebox\naturalsizebox{#2}%
	\settowidth\naturalwidth{#2}%
	\naturalwidth=\wd\naturalsizebox
	\minimumwidth=\dimexpr #1\relax
	\leavevmode%(\the\naturalwidth, \the\minimumwidth)%
	\ifdim\naturalwidth<\minimumwidth\relax
	\makebox[\minimumwidth][l]{\usebox{\naturalsizebox}}%
	\else
	\usebox{\naturalsizebox}%
	\fi
}

\newcommand{\atleastwidthr}[2][2cm]{%
	\savebox\naturalsizebox{#2}%
	\settowidth\naturalwidth{#2}%
	\naturalwidth=\wd\naturalsizebox
	\minimumwidth=\dimexpr #1\relax
	\leavevmode%(\the\naturalwidth, \the\minimumwidth)%
	\ifdim\naturalwidth<\minimumwidth\relax
	\makebox[\minimumwidth][r]{\usebox{\naturalsizebox}}%
	\else
	\usebox{\naturalsizebox}%
	\fi
}

\lstset{framexleftmargin=0.25em,xleftmargin=0.25em}

\NewEnviron{bluebox}{
	\begingroup
		\adjustbox{cfbox=blue!40!white 2pt 10pt,valign=t,bgcolor=blue!5!white}{%
			\begin{minipage}[t]{\dimexpr\linewidth-24pt\relax}
				\BODY
			\end{minipage}%
		}%
	\endgroup
}

\newcounter{maxrecentdisplay}
\setcounter{maxrecentdisplay}{27}

\newcounter{recentcount}
\setcounter{recentcount}{0}

\newcounter{recentskipremaining}

\def\vertlistsep{\hspace{2em}\textcolor{white!100!black}{\vrule width 0.5pt height 0.7\baselineskip\relax}\hspace{2em}}

\def\recentlist{}

%\newcommand{\addtorecentlist}[1]{%
%	\let\do\relax
%	\xdef\recentlist{\recentlist\do{#1}}%
%}

\newcommand{\addtorecentlist}[1]{%
	\bgroup
		\let\do\relax
		\expandafter\gdef\expandafter\recentlist\expandafter{\recentlist\do{#1}}%
		\addtocounter{recentcount}{1}%
	\egroup
	%
	%\xdef\recentlist{\recentlist\do{#1}}%
}

\newcommand{\clearrecentlist}{%
	\gdef\recentlist{}%
	\setcounter{recentcount}{0}%
}

\newif\ifisfirstrecentitem
\newcommand{\printrecentlist}{%
	\setcounter{recentskipremaining}{0}%
	\ifnum\value{recentcount}>\value{maxrecentdisplay}
		\setcounter{recentskipremaining}{\value{recentcount}-\value{maxrecentdisplay}}
	\fi
	%(\therecentskipremaining)
	%(\meaning\recentlist)
	\isfirstrecentitemtrue
	\def\do##1{%
		\ifnum\value{recentskipremaining}>0\relax
			\addtocounter{recentskipremaining}{-1}%
		\else		
			\unless\ifisfirstrecentitem
			\vertlistsep
			\fi
			\isfirstrecentitemfalse
			\textbf{##1}%
		\fi
	}%
	\recentlist
}

\newcommand{\recentpopfront}[1][1]{%
	\typeout{recentpopfront, before: \meaning\recentlist}
	\setcounter{recentskipremaining}{#1}%
	\let\origrecentlist\recentlist
	\clearrecentlist
	\def\do##1{%
		\ifnum\value{recentskipremaining}>0\relax
			\addtocounter{recentskipremaining}{-1}%
		\else		
			\addtorecentlist{##1}%
		\fi
	}%
	\origrecentlist
	\typeout{recentpopfront, after: \meaning\recentlist}
}

\newsavebox\printrecentbox
\savebox\printrecentbox{}
\newsavebox\scratchbox

% \AtBeginDocument{
% \setbox\scratchbox\printrecentbox
% }

\newcommand{\saveprintrecentbox}{%
	\bgroup
		\savebox\printrecentbox{\printrecentlist}%
		\global\setbox\printrecentbox\box\printrecentbox
	\egroup
	% \setbox\scratchbox\printrecentbox
	% \global\setbox\printrecentbox\scratchbox
	% \ifdim\wd\printrecentbox>0.9\textwidth
	% 	\savebox\printrecentbox{\adjustbox{right=0.9\textwidth}{\printrecentlist}}%
	% \else
	% 	\savebox\printrecentbox{\adjustbox{left=0.9\textwidth}{\printrecentlist}}%
	% \fi
}

\newcommand{\shrinkrecentbox}[1]{%
	{\loop
		%\clearrecentlist
		%\saveprintrecentbox
		%(SavedEmptyBox)
		%\iffalse


		\ifdim\wd\printrecentbox>\dimexpr #1\relax
		%
		\recentpopfront[1]%
		\saveprintrecentbox
	\repeat}%
}

% Based on miniframes code
\setbeamertemplate{headline}
{%
	\begin{beamercolorbox}[colsep=1.5pt]{upper separation line head}
	\end{beamercolorbox}
	\begin{beamercolorbox}{section in head/foot}
		\vskip2pt\insertnavigation{\paperwidth}\vskip2pt
	\end{beamercolorbox}%
	%
	\begin{beamercolorbox}[colsep=1.5pt]{middle separation line head}
	\end{beamercolorbox}
	\begin{beamercolorbox}[
		ht=2.5ex,
		dp=1.125ex,
		leftskip=.3cm,rightskip=.3cm plus1fil
		]{subsection in head/foot}
		\usebeamerfont{subsection in head/foot}%\insertsubsectionhead
		% \savebox\printrecentbox{\printrecentlist}%
		% \ifdim\wd\printrecentbox>0.9\textwidth
		% 	\adjustbox{right=0.9\textwidth}{\printrecentlist}%
		% \else
		% 	\adjustbox{left=0.9\textwidth}{\printrecentlist}%
		% \fi
		\saveprintrecentbox
		\ifdim\wd\printrecentbox>0.9\textwidth
			%(Shrinking box)
			%\PackageError{debug}{Width is \the\wd\printrecentbox}{}%
			\shrinkrecentbox{0.6\textwidth}%
		\else
			%(Not shrinking box)
		\fi
		\usebox\printrecentbox
		%\textbullet\ Hey
	\end{beamercolorbox}%
	%
	\begin{beamercolorbox}[colsep=1.5pt]{lower separation line head}
	\end{beamercolorbox}
}

\makeatletter

\NewEnviron{colC}[2][]{%
	\def\setpadd{}%
	\if\relax #1\relax
	\else
		%\def\setpadd{padding={0pt {\dimexpr ((#1)-\height)\relax} {0pt} {0pt}}}%
		\def\setpadd{%
			set depth={\dimexpr (#1)-\height\relax}%
		}
	\fi
	% \def\setparboxargs{}%
	% \if\relax #1\relax
	% \else
	% 	\def\setparboxargs{[t][\dimexpr #1\relax][]}%
	% \fi
	%
	\expandafter\adjustbox\expandafter{\setpadd,
		%margin=0pt,padding=0pt,
	%padding={0pt {\dimexpr (0.4\textheight-\height)/2\relax} {0pt} {\dimexpr (0.4\textheight-\height)/2\relax}},
		fbox=1pt 0pt 0pt,
		valign=M
	}%
	{%
		\parbox{\dimexpr #2-2pt\relax}{%
			\BODY
		}%
	}%
}

\NewEnviron{colT}[2][]{%
	\def\setpadd{}%
	\if\relax #1\relax
	\else
		\def\setpadd{%
			set depth={\dimexpr (#1)-\height\relax}%
		}%
	\fi
	%
	\expandafter\adjustbox\expandafter{\setpadd,
		fbox=1pt 0pt 0pt,
		valign=T
	}%
	{%
		\parbox{\dimexpr #2-2pt\relax}{%
			\BODY
		}%
	}%
}

\makeatother

\newlength\atleastlength


\newenvironment{noindentlist}{
	\begin{list}{\textbullet}{
		\leftmargin=0pt\relax
		\itemindent=0pt\relax
		\setlength{\itemsep}{2pt}
	}
}{
	\end{list}
}

